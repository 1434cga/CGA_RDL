stcI_HASH : Module_Name
stcI_FILEPREFIX : KEYManagerService/src/
stcI_FILEPOSTFIX : InputManager
stcI_EXTENSION : h
Set : $iterate_comments = OFF
SetI : $MODULENAME = KEY
/*
 *   This software is copyright protected and proprietary to
 *   LG electronics. LGE grants to you only those rights as
 *   set out in the license conditions. All other rights remain
 *   with LG electronics.
 * \author  Jong Kyung Byun
 * \date    2017.11.14
 * \attention Copyright (c) 2015 by LG electronics co, Ltd. All rights reserved.
 */

#ifndef SERVICELAYER_+<+uc($MODULENAME)+>+_INPUT_MANAGER_H
#define SERVICELAYER_+<+uc($MODULENAME)+>+_INPUT_MANAGER_H

#include <binder/IBinder.h>
#include <binder/IInterface.h>

#include <utils/Handler.h>
#include <utils/SLLooper.h>
#include <utils/Timer.h>
#include <utils/external/mindroid/lang/String.h>

/*!! appmgr Inheritance CGA start-------------------------------------------------*/
#include "services/ApplicationManagerService/IApplicationManagerService.h"
/*!! appmgr Inheritance CGA end-------------------------------------------------*/


IFEQUAL(+<+$Related_Manager{vif}{VALUE}+>+  eq "O")+{{+
/*!! vif Inheritance CGA start-------------------------------------------------*/
#include "services/vifManagerService/IvifManagerService.h"
#include "services/vifManagerService/IvifManagerReceiver.h"
/*!! vif Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{system}{VALUE}+>+  eq "O")+{{+
/*!! system Inheritance CGA start-------------------------------------------------*/
#include "services/SystemManagerService/ISystemReceiver.h"
#include "services/SystemManagerService/ISystemManagerService.h"
/*!! system Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{hmi}{VALUE}+>+  eq "O")+{{+
/*!! hmi Inheritance CGA start-------------------------------------------------*/
#include <services/HMIManagerService/IHMIEventReceiver.h>
#include <services/HMIManagerService/IHMIManagerService.h>
#include <services/HMIManagerService/IHMIManagerServiceType.h>
/*!! hmi Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{loc}{VALUE}+>+  eq "O")+{{+
/*!! loc Inheritance CGA start-------------------------------------------------*/
#include <services/LocationManagerService/LocationData.h>
#include <services/LocationManagerService/ILocationReceiver.h>
#include <services/LocationManagerService/ILocationManagerService.h>
#include <services/LocationManagerService/ILocationManagerServiceType.h>
/*!! loc Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{audio}{VALUE}+>+  eq "O")+{{+
/*!! Audio Inheritance CGA start-------------------------------------------------*/
#include <services/AudioManagerService/IAudioManagerService.h>
#include <services/AudioManagerService/IAudioManagerServiceType.h>
/*!! Audio Inheritance CGA end-------------------------------------------------*/
+}}+

#include <services/+<+ucfirst($MODULENAME)+>+ManagerService/+<+ucfirst($MODULENAME)+>+Command.h>

class +<+ucfirst($MODULENAME)+>+ManagerService;

enum {
	MSG_RECEIVE_BOOT_COMPLETE = 1,
	MSG_RECEIVE_WATCH_DOG = 2,
	MSG_BOOT_COMPLETE_DID_START = 3,
	MSG_SIGNAL_INTERNAL_IGNITION2_STATUS = 4,
/*!! app manager  Inheritance CGA start-------------------------------------------------*/
	MSG_CONNECT_TO_APPMGR = 13,
/*!! app manager  Inheritance CGA end-------------------------------------------------*/

ITERATE %Related_Manager +<<+ ITKEY  ITVALUE
IFEQUAL(+<+$Related_Manager{ITKEY}{VALUE}+>+  eq "O")+{{+
/*!! ITKEY Inheritance CGA start-------------------------------------------------*/
	MSG_CONNECT_TO_+<+uc(ITKEY)+>+MGR ,
	MSG_RECEIVE_FROM_+<+uc(ITKEY)+>+ ,
/*!! ITKEY Inheritance CGA end-------------------------------------------------*/
+}}+

+>>+

/*!! DID_WORK_FOR_DEFINE_0 msg CGA start-------------------------------------------------*/
ITERATE %Function +<<+ ITKEY  ITVALUE
	MSG_ITKEY , 
+>>+
/*!! DID_WORK_FOR_DEFINE_0 msg CGA end-------------------------------------------------*/

	TIME_SEND_RETRY_DELAY_MS  = 500,
};


class +<+ucfirst($MODULENAME)+>+InputManager: public android::RefBase
{
    public:
	class +<+ucfirst($MODULENAME)+>+Handler: public sl::Handler {
        public:
            +<+ucfirst($MODULENAME)+>+Handler(android::sp<sl::SLLooper>& looper, +<+ucfirst($MODULENAME)+>+InputManager& outer) :
            Handler(looper), m+<+ucfirst($MODULENAME)+>+InputMgr(outer) { }
            virtual void handleMessage(const android::sp<sl::Message>& msg);

        private:
            +<+ucfirst($MODULENAME)+>+InputManager& m+<+ucfirst($MODULENAME)+>+InputMgr;
    };

    class +<+ucfirst($MODULENAME)+>+InputMgrTimer : public TimerTimeoutHandler {
        public:
        /* Timer ID */
            static const uint32_t +<+uc($MODULENAME)+>+_WATCHDOG_TIMER = 1;

            explicit +<+ucfirst($MODULENAME)+>+InputMgrTimer(android::sp<+<+ucfirst($MODULENAME)+>+InputManager::+<+ucfirst($MODULENAME)+>+Handler> handler) :	mHandler(handler) { }
                virtual void handlerFunction(int timer_id) {
                    LOGV("+<+ucfirst($MODULENAME)+>+InputMgrTimer is received");
                    switch(timer_id) {
                        case +<+uc($MODULENAME)+>+_WATCHDOG_TIMER:
                            mHandler->obtainMessage(MSG_RECEIVE_WATCH_DOG)->sendToTarget();

                            break;
                        default :
                            break;
                    }
                }
        private:
            android::sp<+<+ucfirst($MODULENAME)+>+InputManager::+<+ucfirst($MODULENAME)+>+Handler> mHandler;
    };

	void onServiceBinderDied(const android::wp<android::IBinder>& who);

    class ServiceDeathRecipient : public android::IBinder::DeathRecipient {
        public:
            ServiceDeathRecipient(+<+ucfirst($MODULENAME)+>+InputManager& parent) : mParent(parent) {}
            virtual ~ServiceDeathRecipient() {}
            virtual void binderDied(const android::wp<android::IBinder>& who)
            { mParent.onServiceBinderDied(who);}
        private:
            +<+ucfirst($MODULENAME)+>+InputManager& mParent;
    };
	
/*!! appmgr Inheritance CGA start-------------------------------------------------*/
    class systemPostReceiver: public BnSystemPostReceiver {
        public:
            systemPostReceiver(android::sp<+<+ucfirst($MODULENAME)+>+InputManager::+<+ucfirst($MODULENAME)+>+Handler> handler) : mHandler(handler) {}  // charles : remove explicit & change the name
            virtual bool onSystemPostReceived(const android::sp<Post>& systemPost) {
                LOGV("systemPostReceiver Boot Complete");   // charles : chage the name (log)
                android::sp<sl::Message> message = mHandler->obtainMessage(MSG_RECEIVE_BOOT_COMPLETE);
                message->sendToTarget();
                return true;
            }
            virtual ~systemPostReceiver() {}  // charles : add destructor
        private:
            android::sp<+<+ucfirst($MODULENAME)+>+InputManager::+<+ucfirst($MODULENAME)+>+Handler> mHandler;
    };
/*!! appmgr Inheritance CGA end-------------------------------------------------*/

ITERATE %Related_Manager +<<+ ITKEY  ITVALUE
IFEQUAL(+<+$Related_Manager{ITKEY}{VALUE}+>+  eq "O")+{{+
/*!! ITKEY Inheritance CGA start-------------------------------------------------*/
class ITKEYReceiver: public +<+$Related_Manager{ITKEY}{BnReceiverClass}+>+ {
	public:
		ITKEYReceiver(android::sp<+<+ucfirst($MODULENAME)+>+InputManager::+<+ucfirst($MODULENAME)+>+Handler> handler) : mHandler(handler){}     // charles : unify the Receiver class name
		virtual ~ITKEYReceiver() {}  // charles : add destructor in all services

IFEQUAL(ITKEY eq "audio")+{{+
        virtual void onAudioPlayStateChanged(uint8_t dtc_type){
            LOGV("%s AUDIO dtc_type[%d]",__FUNCTION__, dtc_type);
            sp<sl::Message> message = mHandler->obtainMessage(MSG_RECEIVE_FROM_AUDIO, (int32_t)dtc_type);
            message->sendToTarget();
        }
+}}+

IFEQUAL(ITKEY eq "hmi")+{{+
        virtual void onHMIReceived(uint32_t hmi_type, uint32_t hmi_action)
        {
            LOGV("onHMIReceived hmi_type:%d hmi_action:%d ", hmi_type, hmi_action);
            sp<sl::Message> message = mHandler->obtainMessage(MSG_RECEIVE_FROM_HMI, hmi_type, hmi_action);
            message->sendToTarget();
        }
+}}+

IFEQUAL(ITKEY eq "loc")+{{+
		// virtual ~WifiLocationReceiver(){}  // charles : exist up & remove MODULENAME(Wifi)

		virtual void onLocationInfoChanged(android::sp<LocationData> locData){}
		virtual void onGPSStatusChanged(gps_status_t status){}
		virtual void onGPSTTFFTime(long TTFFTime){}
		virtual void onGPSGpsPosReportStatusChanged(uint8_t status){}
		virtual void onGNSSJammingStatusChanged(bool jamming){}
		virtual void onNMEAData(const char* nmea){}
		virtual void onGNSSFixDataForSVT(android::sp<LocationDataQuality> loc_data){}
		virtual void onDTCStatus(bool status){}
		virtual void onLocationDataAvailableChanged(bool status){}
		virtual void onDTCStatusbyName(int32_t pName, int32_t value){}
+}}+

IFEQUAL(ITKEY eq "system")+{{+
		// virtual ~WifiSystemReceiver() {}  // charles : exist up & remove MODULENAME(Wifi)
		virtual void onAntennaReceived(int32_t antenna_type, uint32_t dtc_status, int32_t dtc_fault_cnt, int32_t id)
		{
		}
+}}+

IFEQUAL(ITKEY eq "vif")+{{+
        virtual void onReceive(uint32_t Sigid, android::sp<Buffer>& buf)
        {
			LOGV("+<+ucfirst($MODULENAME)+>+InputManager   onReceive vif Sigid:0x%02X", Sigid);
			android::sp<sl::Message> message = mHandler->obtainMessage(MSG_RECEIVE_FROM_+<+uc(ITKEY)+>+, Sigid);
			if (buf->size() > 0) {
			    message->buffer.setTo(buf->data(), buf->size());
			} else {
			    LOGE("ITKEY : CAN signal received without data.");
			}
            message->sendToTarget();
            return;
        }
+}}+

		// write the virtual functions from BnReceiver
		// virtual void onLocationInfoChanged(android::sp<LocationData> locData){}
        // virtual void onGPSStatusChanged(gps_status_t status){}
		// ....... etc.

	private:
		android::sp<+<+ucfirst($MODULENAME)+>+InputManager::+<+ucfirst($MODULENAME)+>+Handler> mHandler;

	};
/*!! ITKEY Inheritance CGA end-------------------------------------------------*/

+}}+
+>>+

    public:
        +<+ucfirst($MODULENAME)+>+InputManager(android::sp<+<+ucfirst($MODULENAME)+>+ManagerService> m+<+ucfirst($MODULENAME)+>+MgrService);
        virtual ~+<+ucfirst($MODULENAME)+>+InputManager();
        error_t init();
        error_t messagefromVIF(uint16_t sigId, android::sp<Buffer>& buf);
		error_t transferDatabyVIF (android::sp<+<+ucfirst($MODULENAME)+>+Data>& m+<+lc($MODULENAME)+>+Data);

/*!! DID_WORK_FOR_DEFINE_0 header CGA start-------------------------------------------------*/	
ITERATE %Function +<<+ ITKEY  ITVALUE
		error_t FUNC_ITKEY(uint8_t* data);
+>>+
/*!! DID_WORK_FOR_DEFINE_0 header CGA end-------------------------------------------------*/

    private:
/*!! appmgr Inheritance CGA start-------------------------------------------------*/
        void connectToAppMgr(void);
/*!! appmgr Inheritance CGA end-------------------------------------------------*/

ITERATE %Related_Manager +<<+ ITKEY  ITVALUE
IFEQUAL(+<+$Related_Manager{ITKEY}{VALUE}+>+  eq "O")+{{+
/*!! ITKEY Inheritance CGA start-------------------------------------------------*/
        void connectTo+<+$Related_Manager{ITKEY}{usingName}+>+Mgr(void);
/*!! ITKEY Inheritance CGA end-------------------------------------------------*/
+}}+
+>>+


    private:
        android::sp<+<+ucfirst($MODULENAME)+>+ManagerService> m+<+ucfirst($MODULENAME)+>+MgrService;
        android::sp<+<+ucfirst($MODULENAME)+>+Handler> mMyHandler;

/*!! appmgr Inheritance CGA start-------------------------------------------------*/	
		android::sp<IApplicationManagerService> mAppManager;
		android::sp<ISystemPostReceiver> mSystemPostReceiver;
/*!! appmgr Inheritance CGA end-------------------------------------------------*/ 

IFEQUAL(+<+$Related_Manager{audio}{VALUE}+>+  eq "O")+{{+
/*!! audio Inheritance CGA start-------------------------------------------------*/ 
        android::sp<IAudioReceiver> mAudioReceiver;
		android::sp<IAudioManagerService> mAudioManager;
/*!! audio Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{hmi}{VALUE}+>+  eq "O")+{{+
/*!! hmi Inheritance CGA start-------------------------------------------------*/ 
        android::sp<IHMIEventReceiver> mHmiReceiver;
		android::sp<IHMIManagerService> mHmiManager;
/*!! hmi Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{loc}{VALUE}+>+  eq "O")+{{+
/*!! loc Inheritance CGA start-------------------------------------------------*/ 
        android::sp<ILocationManagerService> mLocManager;
        android::sp<ILocationReceiver> mLocReceiver;
/*!! loc Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{system}{VALUE}+>+  eq "O")+{{+
/*!! system Inheritance CGA start-------------------------------------------------*/ 
		android::sp<ISystemAntennaReceiver> mSystemReceiver;
		android::sp<ISystemManagerService> mSystemManager;
/*!! system Inheritance CGA end-------------------------------------------------*/
+}}+

IFEQUAL(+<+$Related_Manager{vif}{VALUE}+>+  eq "O")+{{+
/*!! vif Inheritance CGA start-------------------------------------------------*/ 
        android::sp<IvifManagerReceiver> mVifReceiver;
		android::sp<IvifManagerService> mVifManager;
/*!! vif Inheritance CGA end-------------------------------------------------*/
+}}+
        Timer* m_WatcdogTimer;
        +<+ucfirst($MODULENAME)+>+InputMgrTimer* m+<+ucfirst($MODULENAME)+>+InputMgrTimer;

        android::sp<ServiceDeathRecipient> mServiceDeathRecipient;
};

#endif /* SERVICELAYER_+<+uc($MODULENAME)+>+_INPUT_MANAGER_H */
